# 客戶郵件發送系統

這是一個功能完整的客戶郵件發送系統，可以管理客戶資料並批量發送郵件。

## 功能特色

1. **智能郵件發送**
   - 透過 Gmail 發送郵件給客戶
   - 支援批量發送，自動批次處理
   - 可選擇特定客戶或全部客戶
   - 支援郵件內容中使用 `{name}` 佔位符自動替換客戶名稱
   - **發送記錄追蹤**：自動記錄每個客戶的發送狀態
   - **隔天接續發送**：可選擇只發送今天未發送的客戶，方便隔天繼續發送
   - **實時進度顯示**：顯示發送進度、成功/失敗數量、剩餘配額

2. **Gmail 限制管理**
   - 自動追蹤每日發送配額（450 封/天，保守值）
   - 智能速率控制（每分鐘/每小時限制）
   - 自動批次延遲，避免觸發 Gmail 限制
   - 發送前自動檢查配額
   - 實時顯示剩餘配額和發送統計

3. **客戶管理**
   - 查看所有客戶資料
   - 查看每個客戶的發送狀態（已發送/未發送）
   - 編輯客戶資訊
   - 刪除客戶
   - 自動去重處理（根據 Email）
   - 重置發送記錄功能

4. **資料導入**
   - 支援 JSON 格式導入
   - 支援 CSV 格式導入
   - 自動去重處理

## 安裝步驟

1. 進入專案目錄：
```bash
cd 郵件發送系統
```

2. 安裝依賴套件：
```bash
npm install
```

## 使用說明

### 啟動伺服器

```bash
npm start
```

伺服器將在 `http://localhost:3000` 啟動。

### 設定 Gmail 應用程式密碼

由於 Gmail 的安全設定，您需要使用「應用程式專用密碼」而非一般的 Gmail 密碼。

1. 前往 [Google 帳戶設定](https://myaccount.google.com/)
2. 點選「安全性」
3. 啟用「兩步驟驗證」（如果尚未啟用）
4. 在「應用程式密碼」區段，選擇「郵件」和「其他（自訂名稱）」
5. 輸入應用程式名稱（例如：郵件發送系統）
6. 複製產生的 16 位數密碼
7. 在發送郵件時使用此密碼，而非您的 Gmail 密碼

### 使用介面

1. **發送郵件標籤頁**
   - 輸入發送者 Gmail 和應用程式密碼
   - 填寫郵件主旨和內容
   - 選擇收件人（可多選或選擇全部）
   - 點擊「發送郵件」

2. **客戶管理標籤頁**
   - 查看所有客戶列表
   - 點擊「編輯」修改客戶資料
   - 點擊「刪除」移除客戶
   - 點擊「去重處理」自動移除重複的客戶（根據 Email）

3. **導入資料標籤頁**
   - **JSON 格式**：輸入 JSON 陣列，例如：
     ```json
     [
       {"name":"客戶名稱","email":"email@example.com","phone":"0912345678"},
       {"name":"另一個客戶","email":"another@example.com","phone":"0987654321"}
     ]
     ```
   - **CSV 格式**：每行一個客戶，格式為：`名稱,Email,電話`
     ```
     客戶名稱,email@example.com,0912345678
     另一個客戶,another@example.com,0987654321
     ```

## 資料格式

客戶資料格式：
```json
{
  "id": "唯一識別碼",
  "name": "客戶名稱",
  "email": "客戶Email",
  "phone": "電話號碼"
}
```

## 注意事項

1. 使用 Gmail 發送郵件時，必須使用「應用程式專用密碼」，不能使用一般的 Gmail 密碼
2. Gmail 有每日發送限制（約 500 封），系統已設定保守值 450 封/天，並自動管理速率限制
3. 系統會自動根據 Email 進行去重處理
4. 郵件內容中可使用 `{name}` 作為客戶名稱的佔位符
5. **發送記錄**：系統會自動記錄每個客戶的發送狀態，方便隔天接續發送
6. **建議使用「只發送未發送的客戶」選項**：勾選後可自動跳過今天已發送的客戶

## 技術架構

- **後端**：Node.js + Express
- **前端**：HTML + CSS + JavaScript
- **郵件發送**：Nodemailer
- **資料儲存**：JSON 檔案
- **發送限制管理**：自動追蹤 24 小時滾動窗口的發送統計
- **批次處理**：智能批次發送，自動延遲控制

## 發送記錄功能

系統會自動記錄每個客戶的發送狀態：

- **lastSentDate**：最後發送日期（YYYY-MM-DD）
- **sentCount**：總發送次數
- **sendHistory**：發送歷史記錄陣列

### 使用場景

**場景 1：今天發送 300 封，明天繼續發送剩餘的**
1. 今天：勾選「只發送未發送的客戶」，發送 300 封
2. 明天：勾選「只發送未發送的客戶」，系統自動跳過昨天已發送的，只發送剩餘的

**場景 2：查看發送進度**
- 在「客戶管理」頁面查看每個客戶的發送狀態
- 查看統計資訊（已發送/未發送數量）

**場景 3：重新發送**
- 點擊「重置今日發送記錄」按鈕
- 確認後，所有客戶恢復為「未發送」狀態

## 疑難排解

### 無法發送郵件
- 確認已使用「應用程式專用密碼」而非 Gmail 密碼
- 確認已啟用 Gmail 的「兩步驟驗證」
- 檢查網路連線

### 資料無法導入
- 確認 JSON 格式正確（必須是陣列）
- 確認 CSV 格式正確（每行：名稱,Email,電話）

## 授權

ISC License
